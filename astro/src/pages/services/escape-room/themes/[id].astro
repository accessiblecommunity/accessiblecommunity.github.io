---
import { getCollection, render, type CollectionEntry } from "astro:content";
import { getOpenGraphImageData } from "src/lib/og-image";
import type { Breadcrumbs, PageMetadata } from "src/lib/types";
import components from "src/lib/mdx";

export async function getStaticPaths() {
  const crumbs: Breadcrumbs = [
    {
      name: "Home",
      href: "/services/escape-room/",
    },
  ];

  const rooms: Array<CollectionEntry<"escapeRoomThemes">> =
    await getCollection("escapeRoomThemes");

  return rooms.map((room) => {
    const metadata: PageMetadata = {
      title: room.data.title,
      description: `Overview of the ${room.data.title} Accessible Escape Room`,
      image: getOpenGraphImageData(Astro.site, "pages", "escape-room"), // Fix
    };

    return {
      params: { id: room.id },
      props: { room, crumbs, metadata },
    };
  });
}

interface Props {
  room: CollectionEntry<"escapeRoomThemes">;
  crumbs: Breadcrumbs;
  metadata: PageMetadata;
}

const { room, crumbs, metadata } = Astro.props;
const { image, title } = room.data;
const { Content } = await render(room);

import Hero from "@components/HeroWithBreadcrumbs.astro";
import Layout from "src/layouts/EscapeRoomLayout.astro";
import ThemedSection from "@components/ThemedSection.astro";
---

<Layout {metadata}>
  <Hero slot="header" image={room.data.image} {crumbs} {title}>
    <div class="px-2" slot="heading">
      <h1
        class:list={["display-2 text-white w-100"]}
        set:html={room.data.titleHtml}
      />
    </div>
  </Hero>
  <ThemedSection style="tertiary">
    <div class="py-3">
      <p class="text-bg-hero" set:text={room.data.tagline} />
    </div>
    <Content {components} />
  </ThemedSection>
</Layout>
